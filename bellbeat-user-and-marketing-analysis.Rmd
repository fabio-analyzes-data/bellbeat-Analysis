
# Business Task and Problem-question:

The business task can be defined as :

Gain insight into possible marketing strategies and growth opportunities by **analyzing and identifying usage trends of consumers of non-bellbeat smart devices.**

Where stakeholders are:

-   Bellbeats marketing department is the main stakeholder since the insights of this analysis will likely be of direct use to their efforts. Furthermore, product development and customer satisfaction departments might gather useful insights from the results of the analysis. Lastly, Urška Sršen and Sando Mur, founders are also considered stakeholders for this project.

# Preparing the data

### Data credibility and reliability

The data set is comprised of 18 data tables generated by fitbit users who voluntarily submitted their data to an Amazon Turk Survey between 03/12/2016-05/12/2016.

-   Though credible, data might be considered outdated, it has not been updated in roughly 6 years and it does not account for demographic behavioral changes from the CODIV-19 pandemic

-   Data is of public access and use, properly anonymized and time stamped.

### Exploratory Data Summaries

```{r package installers and loaders}
library(lubridate)
library(tidyverse)
library(skimr)
```

```{r loading data}
setwd("./Sources")
dailyActivity <- read.csv("dailyActivity_merged.csv")
dailyCalories <- read.csv("dailyCalories_merged.csv")
dailyIntensities <- read.csv("dailyIntensities_merged.csv")
sleepDay <- read.csv("sleepDay_merged.csv")
weightLogInfo <- read.csv("weightLogInfo_merged.csv")
```

### Data Summaries

-   Gathering column names, datatypes and general information stored in each data table

```{r data summary daily Activity}
head(dailyActivity)
```

```{r data summary daily Calories}
head(dailyCalories)

```

```{r data summary daily intensity}
head(dailyIntensities)
```

```{r data summary sleepDay}
head(sleepDay)
```

```{r data summary weightLogInfo}
head(weightLogInfo)
```

The dailyActivity table merges information from other daily tables, such as dailyIntensities, dailySteps and so on. However, it does not merge information from weightLogInfo and, most importantly, Sleepday.

This could indicate SleepDay and WeightLogInfo are user input only tables or a mixture of tracking and user input. Further data processing and analysis of the weightLogInfo and SleepDay data could corroborate this.

# Data Processing and Cleaning

### Data consistency: Number of Unique User Id's

Determine the amount of unique participants per table.

```{r unique participants per data set}
n_distinct(dailyActivity$Id)
n_distinct(dailyIntensities$Id)
n_distinct(dailyCalories$Id)
n_distinct(sleepDay$Id)
n_distinct(weightLogInfo$Id)

```

Data automatically collected by the fitbit has 33 different Ids, whereas data that required used input has considerable less users Ids

-   Users might be less likely to manually update their own metrics. The weightLogInfo has data for only 8 different Ids
-   weightLogInfo data conclusion could be considered unreliable, due to small sample size

```{r skimming data}
skim_without_charts(dailyActivity)
skim_without_charts(dailyCalories)
skim_without_charts(dailyIntensities)
skim_without_charts(sleepDay)
skim_without_charts(weightLogInfo)
```

On data consistency between data tables:

-   Two data tables (weightLogInfo and SleepDay) have less unique Ids when compared to the rest of the sets. Both sleepDay and weightLogInfo have 24 and 8 distinct Id's respectively, compared to 33 unique Id's from other data sets.

-   65 values for fat percentage are missing from the weightLogInfo table.

-   All other tables are appear internally consistent.

### Data consistency: Number of Observations.

Data tables can be categorized in one of three types:

-   Data is automatically collected by the fitbit. This appears to be the case for all 'daily' data tables

-   Data has to be input by user. This appears to be the case for the weighLogInfo table

-   Data is a mixture of both inputs. This appears to be the case for SleepDay

For this to hold true, all 'daily' data tables must hold the same number of data points, since data is automatically recorded by the smart device. Furthermore, Tables that require user input will likely have a variable number of inputs

```{r Number of data rows per data table}
nrow(dailyActivity)
nrow(dailyCalories)
nrow(dailyIntensities)
nrow(sleepDay)
nrow(weightLogInfo)
```

-   All the 'daily' data tables have the same number of observations. Weight and Sleep days present higher variability, since their inputs are not automatic

### Data Consistency: TimeFrames

```{r comparing data set lenght in days}
dailyActivity %>% 
  mutate(date = as.Date(ActivityDate, "%m/%d/%Y")) %>% 
  summarize(startDate = min(date), endDate = max(date), startDate-endDate)

dailyCalories %>% 
  mutate(date = as.Date(ActivityDay, "%m/%d/%Y")) %>% 
  summarize(startDate = min(date), endDate = max(date), startDate-endDate)

dailyIntensities %>% 
  mutate(date = as.Date(ActivityDay, "%m/%d/%Y")) %>% 
  summarize(startDate = min(date), endDate = max(date), startDate-endDate)

sleepDay %>% 
  mutate(date = as.Date(SleepDay, "%m/%d/%Y")) %>% 
  summarize(startDate = min(date), endDate = max(date), startDate-endDate)

weightLogInfo %>% 
  mutate(date = as.Date(Date, "%m/%d/%Y")) %>% 
  summarize(startDate = min(date), endDate = max(date), startDate-endDate)
```

-   The time frame of all data tables is consistent. Data was collected between the dates of 2016/04/12 and 2016/05/12.

### Data Consistency: Conclusion and Reflections

Data tables differ based on how data points are collected, in turn, this creates different challenges per based on the the method with which data as gathered.

If data was gathered automatically by the smart device:

-   Device might continue to track and record data even when not in use, when placed over a nightstand, table, or in any other standby state. In turn, this can generate odd values for some of the daily metrics, such as days with no burned calories, no active steps, or a full day of sedentary activity.

If data requires user input:

-   If data requires user input a scenario could take place where most of the data comes from a single Id, instead of multiple different users. If not addressed the conclusions derived from the data table might be skewed to reflect the behavioral preferences of a particular user, rather than the sample population

# Data Cleaning

As previously mentioned, 'daily' data sets might record data even when not actively in use. Evidence of this can be found on variables like TotalSteps or Calories, both of them hold records with 0 values, which does not hold to scrutiny. According the Mayo Clinic, the average number of steps for an American adult oscillates between 3000 and 4000 steps per day, several records in the dailyActivity and dailySteps data tables sit well below this mark. The same can be said of caloric records both in the 'dailyActivity' as well as 'dailyCalories' data tables.

This unusual behavior can be explained if the device tracks and records data even when not actively in use, while resting on a table, or charging. By the same rational, records might be prompted midday, or whenever a consumer dons the device.

### Data filtering and Extracting Variables of interest

```{r Processing dailyActivity}
colnames(dailyActivity)
activityFrame <- dailyActivity %>% 
  select(Id, ActivityDate, TotalSteps, Calories, VeryActiveMinutes, SedentaryMinutes) %>% 
  mutate(date = as.Date(ActivityDate, "%m/%d/%Y"), weekDay=wday(date, label=TRUE)) %>% 
  arrange(TotalSteps) %>% 
  filter(TotalSteps > 1500, SedentaryMinutes > 20)
```

```{r Processing dailyCalories }
colnames(dailyCalories)
caloriesFrame <-dailyCalories %>% 
  mutate(date = as.Date(ActivityDay, "%m/%d/%Y"), weekDay=wday(date, label=TRUE)) %>% 
  filter(Calories > 0)
```

```{r}
intensityFrame <- dailyActivity %>% 
  select(Id, ActivityDate, VeryActiveMinutes, FairlyActiveMinutes, LightlyActiveMinutes, SedentaryMinutes, Calories, VeryActiveDistance, ModeratelyActiveDistance, LightActiveDistance, SedentaryActiveDistance, LoggedActivitiesDistance) %>% 
  mutate(date = as.Date(ActivityDate, "%m/%d/%Y"), weekDay=wday(date, label=TRUE)) %>% 
  filter(Calories>0)

```

```{r Processing sleepDay }
colnames(sleepDay)
sleepFrame <- sleepDay %>% 
  mutate(date = as.Date(SleepDay, "%m/%d/%Y"), weekDay=wday(date, label=TRUE))
```

### Weight Log Info Data Analysis

User data on weight presents a series of unique challenges that renders its analysis unfruitful. Since data is not automatically recorded, but manually input but each users, two users are responsible for more than 50% of all records in the table. Because of this, any statistical analysis made over the table will be unlikely to reflect the behavior of the sample population at large.

```{r Processing WeightLogInfo}
weightLogInfo %>% drop_na()
weightLogInfo %>% group_by(Id) %>% count()
```

-   Fat data in the weight table has only two values.

-   Data input in weightLogInfo varies from user between users. Out of 67 data rows, 55 are supplied by only to users

# Data Processing and Analysis

### Standard Statistics

This process encompasses a preliminary look at some key statistical values inside each data table with variables of interest. The main purpose of this process is to further familiarize with the values of the data and formulate specific question that relate to the business task.

```{r daily activities}
str <- 'dailyActivity'
activityFrame %>%
  select(SedentaryMinutes, TotalSteps, Calories) %>% 
  summary()

```

-   Sedentary minutes can give a glimpse into the type of daily activities consumers are likely to engage throughout the day.

-   It can also give a better understanding on which days of the week consumers are likely to be more active and therefore less sedentary

```{r dailyCalories}
colnames(dailyCalories)
caloriesFrame %>%
  select(Calories) %>% 
  summary()
```

-   Does caloric consumption vary with time frames (weekdays, months, and so on) or remains constant?
-   Which weekdays have a higher degree of caloric consumption?

```{r DailyIntensities}
colnames(dailyIntensities)
dailyIntensities %>% 
  select(SedentaryMinutes, FairlyActiveMinutes, VeryActiveMinutes, SedentaryActiveDistance, ModeratelyActiveDistance, VeryActiveDistance) %>% 
  summary()
```

-   Is there a correlation between active minutes and active distance?
    -   This question might seem redundant, however, if distance is calculated as a function of geolocation, analyzing the behavior of these two variables can help determine whether consumers engage in high intensity activities whilst geographically stationary. i.e. Exercising at a gym.

```{r sleepDay}
colnames(sleepDay)
head(sleepDay)
sleepFrame %>% select(TotalSleepRecords, TotalMinutesAsleep, TotalTimeInBed) %>% 
  summary()
```

-   Average length of the sleep cycle and time in bed. Variations over time and weekday

## Data Analysis: Plots and Correlations

#### Total Steps

Plotting and analyzing the distribution of total steps per weekday reveals a higher concentration for steps taken during weekdays, specially Tuesdays and Thursdays. On the other hand, Sunday, Friday and Saturday have the lowest median total steps with Saturday displaying a wider distribution of data. Sundays data appears more uniform.

```{r days Of the week and activity per day}

activityFrame %>%
  ggplot(aes(x=weekDay, y=TotalSteps, fill=weekDay)) +
  geom_boxplot(show.legend=FALSE, alpha=0.5, outlier.shape = NA) +
  geom_jitter(show.legend= FALSE, width = 0.25, shape=21, color="black")+
  labs(title="Daily Activity: Week day vs. Total Steps", subtitle = "The median number of total steps is higher overall in weekdays")
  
```

According to Mayo Clinic website, the average American takes from 3000 to 4000 steps a day. Filtering the Steps to accommodate for this results into a following density distribution of total steps per weekday.

The median number of steps oscillates around the 10000 steps per day. However the density distribution is heavily skewed to the right of the median, which indicates a higher probability for fitbit users of taken less than 10000 per day, rather than more.

It is also important to note, the median of the population study sits well above the average presented by the Mayo Clinic.

```{r mean calories per weekday}
activityFrame %>%
  # filter(TotalSteps>3000) %>%
  ggplot(aes(x= TotalSteps, group=weekDay, fill=weekDay)) +
  geom_density(adjust=1.5, alpha=.25, show.legend = FALSE) +
  facet_wrap(~weekDay) +
  theme(
    legend.position = "none",
    panel.spacing = unit(0.1,"lines"),
    axis.ticks.x=element_blank()
  ) +
  labs(title="Distribution of Steps per Day Adjusted")
  

```

#### Calories vs. Total Steps

A proportional direct correlation can be drawn between the number of steps and calories recorded by the smart device. The higher the amount of steps take by the average consumer the higher the calories burned throughout the day.

The correlation between this two variables, however, does not account for the 'type' of steps as recorded by the intensity metric of the smart device, which posses the question of whether the 'intensity' of the steps correlates to more calories being burned.

```{r Correlation between Steps and Intensity}
activityFrame %>% 
  ggplot(aes(x=TotalSteps, y=Calories, palette('Red'))) +
  geom_jitter() +
  geom_smooth( color='red', fill='#69b3a2', se=TRUE) +
  labs( title= 'Daily Total Steps vs. Calories', subtitle = "There's a correlation between Total Steps taken and Calories")
```

Further analysis on the 'intensity' of the steps and its correlation with the amount of calories burned on a daily bases, reveals a somewhat direct relationship between both variables. The amount of the steps can be directly correlated with the amount of consumed calories per day, the 'intensity' of the steps present a less obvious, less strict correlation.

On the other hand, the plot confirms Sunday and Saturdays as the days with higher variability in total steps and 'intense' covered distance.

```{r correlation between intesity and calories}
intensityFrame %>%
  filter(VeryActiveMinutes > 0 ) %>% 
  ggplot(aes(x=VeryActiveDistance, y=Calories, palette('Red'))) +
  geom_point() +
  geom_smooth(color='red', fill='#69b3a2') +
  facet_wrap(~weekDay)+
  labs( title= 'Calories vs. Very Active Distance')
```

#### Correlation between 'Very Active Minutes (VAM)' and 'Very Active Distance (VAD)'

This analysis will give further insight into how the smart device tracks and analyzes distance, whether using geolocation or by interpreting arm movement as steps being taken.

By analyzing the resulting plot we can derive three areas of interest based on the quantity of Very Active Minutes (VAM) recorded by the smart device:

1.  VAM \< 50 mins: VAD is directly correlated to VAM for these values
2.  51 mins \< VAM \< 150 mins: Data starts to spread widely from the trend line. Data indicates longer stretches of VAM with no direct increase on VAD, the opposite holds true as well. This can be interpreted as periods of high intensity activities in a within a shorted distance frame, or in an enclosed space like a gym or training facility.
3.  VAM \> 150 min: Data in this range is fewer and further between one another, the trend line curves and plateaus, indicating longer VAM values do not correspond with a greater covered distance.

Another insight drawn from this analysis is the distribution of activity minutes in the sample population. VAM data is mostly concentrated between 0 and 75 mins, thinning out for greater values of VAM.

```{r Correlation VADistance vs. VAMinutes}
intensityFrame %>%
  filter(VeryActiveMinutes!=0, VeryActiveDistance!=0) %>% 
  ggplot(aes(x=VeryActiveMinutes, y=VeryActiveDistance)) +
  geom_point() +
  geom_smooth(color='red', fill='#69b3a2',se=TRUE) +
  labs( title= 'Active Minutes vs. Active Distance')
```

#### Intensity Distribution per weekday.

From the following plot we can derive some insights such as:

-   Time frames with 'light' activities are the most common throughout week days.

-   Time frames dedicated to 'high' intensity activities present a greater concentration in weekends rather than weekdays.

-   'Fairly' active minutes do not show signs of concentration either during weekdays nor weekends.

```{r intensity distribution}
intensityFrame %>%
  # filter(SedentaryMinutes<900) %>% 
  pivot_longer(VeryActiveMinutes:LightlyActiveMinutes) %>% 
  ggplot()+
  geom_bar(aes(weekDay,value, fill=name), position = 'dodge', stat = 'identity', show.legend = TRUE)+
  labs(title = 'Intensity Distribution Time per weekday')
```

#### Sleep Minutes per Day

The plot indicates higher median values and a less uniform distriburion for Saturdays and Sundays when compared to weekdays. This could be indicate a more rigid schedule during weekdays, when compared to weekends, which could be interpreted as consumers having a standard work week, Monday to Friday, with Saturdays and Sundays as non-weekdays.

```{r Sleep patterns}
sleepFrame %>% 
  ggplot(aes(x=weekDay, y=TotalMinutesAsleep, fill=weekDay))+
  geom_jitter(show.legend= FALSE, width = 0.25, shape=21, color="black")+
  geom_boxplot(show.legend = FALSE, alpha=0.25, outlier.shape = NA)+
  labs(title="Sleep Minutes per Weekday")
```

#### Hours of higher activity weekdays vs. weekends

With a better understanding at how consumers intensive activities and sleep patterns vary throughout the days of the week, the following two plots give us further insights on activity types are distributed per hours of the day.

Surveyors standard week seem to be split into two types of days, weekdays and weekends. The distribution of intensive activities and sleep patterns per weekdays corroborate this hypothesis. In other words, consumers seem to abide to standard work week, with Mondays to Fridays dedicated to activities under a certain rigid schedule, and weekends with lesser restrictions time-wise.

A further analysis of the distribution of the distribution of 'TotalIntesity' per hour of day further corroborates this hypothesis. Weekdays intensity displays an initial peak at 7 am during weekdays, which indicates an early rise for most consumers. Throughout the day 'intensity' remains constant with a secondary peak in the afternoon hours (5 pm - 7pm). In contrast, weekends offer no early morning 'intensity' peak, with a higher intensity concentration around midday.

```{r Hourly Intensity weekdays}
setwd("./Sources")
hourlyIntesity <- read_csv('hourlyIntensities_merged.csv')

hourlyFrame <- hourlyIntesity %>% 
  mutate(weekDay=wday(as.Date(ActivityHour, "%m/%d/%Y"), label=TRUE),
         hourTime=hour(as.POSIXct(ActivityHour, format='%m/%d/%Y %I:%M:%S %p'))
         ) %>% 
  filter(TotalIntensity >0) %>%
  arrange(-TotalIntensity)

hourlyFrame %>%
  filter(weekDay !='Sun' & weekDay!='Sat') %>% 
  mutate(hourTime=as.factor(hourTime)) %>%
  ggplot(aes(x=hourTime, y=TotalIntensity, fill=hourTime))+
  stat_summary(
    geom='bar',
    fun = 'median',
    show.legend = FALSE
  ) +
  labs(title = 'Total Intensity per hour (weekdays)')
```

```{r Hourly Insensity weekends}

hourlyFrame %>%
  filter(weekDay == 'Sun' | weekDay=='Sat') %>%
  mutate(hourTime=as.factor(hourTime)) %>%
  ggplot(aes(x=hourTime, y=TotalIntensity, fill=hourTime))+
  stat_summary(
    geom='bar',
    fun = 'median',
    show.legend = FALSE
  )+
  labs(title = 'Total Intensity per hour (weekends)')
```

#### Hourly heart rate per hour/weekday.

Finally, a detailed analysis of the distribution of heart rates per hour and weekday allows a better look at how consumers spend intensive activities are distributed throughout the day. The plot corroborates previous findings on the disparity distribution of intensities between weekdays and weekends.

The highest median value is for weekdays is likely to occur during the late afternoon hours and during the early afternoon for weekends.

```{r heartRate analysis}
setwd("./Sources")
heartRate <- read_csv('heartrate_seconds_merged.csv')

heartRate <- heartRate %>% 
  mutate(Time=as.POSIXct(Time, format='%m/%d/%Y %I:%M:%S %p'))

heartRate <- heartRate %>% 
  mutate(hourTime=hour(Time), weekDay=wday(Time, label=TRUE))

heartRate %>% 
  group_by(weekDay, hourTime) %>% 
  summarise(medianRate = median(Value)) %>% 
  ggplot(aes(x=hourTime, y=medianRate))+
  geom_line(size=1, alpha=0.7, color='red')+
  geom_ribbon(aes(ymin=min(medianRate), ymax=medianRate), fill = 'red', alpha=0.3, position = "identity")+
  scale_fill_gradient2(position="bottom" , low = "blue", high = "red")+
  facet_wrap(~weekDay)+
  labs(title = 'Median heart date per hour time')
  

```

# Conclusions

The following conclusions can be drawn from the analysis process:

-   There's a correlation between the amounts of steps taken per day and the amount of calories burned per day. This could be incorporated into bellbeats own devices by encouraging and motivating users when a certain threshold of steps are met in a daily basis.

-   Metrics automatically collected by devices tracers can create incongruent data such as whole days with no steps taken, or 1440 mins of sedentary time. This can lead to inaccurate data passed along to consumers. Bellbeat can leverage this limitation by developing algorithms that better filter these types of records, resulting in a better user experience with refined analytics for consumers.

-   Metrics that require user input can offer lower consistency and therefore, reliability. As seen in the weightLogInfo data table, the supplied data was non-uniform on a user basis. Bellbeat can leverage this by developing procedures to remind users to track their metrics for a better experience. This procedures can be tailored to require less detailed user input and a few quick questions, improving user experience.

-   The data analysis process offered the following insights regarding the surveyed fitbit users:

    -   Users appear to follow a standard workweek schedule. Weekdays follow a rigid earlier schedule, when compared to weekends.

    -   Weekdays intensities start earlier, around 5:00 am and peak once more around 6:00 pm. Reminders and encouragement by bellbeat's devices at these times can engage users and improve their experience with the products.

    -   Adjusting reminders and encouragement for weekends, specifically following the hours of higher intensity, can result in an overall better user experience

-   Marketing and other advertising efforts can also adjust time frames based on days and hours of greater activity, allowing for better target audience reach and engagement.
